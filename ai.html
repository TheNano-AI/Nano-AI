<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nano AI Pro</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif;}
body{display:flex;height:100vh;background:#0f172a;color:white;overflow:hidden;}

/* SIDEBAR */
.sidebar{width:280px;background:#111827;display:flex;flex-direction:column;padding:20px;}
.logo{display:flex;align-items:center;margin-bottom:20px;}
.logo img{height:50px;width:50px;object-fit:contain;border-radius:12px;margin-right:10px;}
.logo span{font-size:22px;font-weight:bold;}
.new-chat{padding:12px;background:#2563eb;border:none;color:white;border-radius:14px;cursor:pointer;margin-bottom:15px;font-weight:bold;}
.chat-list{flex:1;overflow-y:auto;}
.chat-item{padding:10px;background:#1f2937;border-radius:12px;margin-bottom:10px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:0.2s;}
.chat-item:hover{background:#374151;}
.chat-item.active{background:#2563eb;}
.chat-actions button{background:none;border:none;color:#aaa;cursor:pointer;font-size:16px;margin-left:5px;}

/* MAIN */
.main{flex:1;display:flex;flex-direction:column;}

/* TOP BAR */
.topbar{height:60px;background:#111827;display:flex;justify-content:flex-end;align-items:center;padding:0 20px;position:relative;}
.profile{cursor:pointer;background:#2563eb;padding:8px 14px;border-radius:20px;user-select:none;}
.dropdown{position:absolute;top:60px;right:20px;background:#1f2937;padding:10px;border-radius:12px;display:none;width:220px;flex-direction:column;}
.dropdown button,.dropdown select{width:100%;margin:5px 0;padding:8px;background:#374151;color:white;border:none;border-radius:12px;cursor:pointer;}
.dropdown select{appearance:none;}

/* CHAT */
.chat{flex:1;padding:20px;overflow-y:auto;display:flex;flex-direction:column;}
.message{margin-bottom:15px;padding:12px;border-radius:14px;word-wrap:break-word;max-width:70%;line-height:1.5;}
.user{text-align:right;color:#60a5fa;background:rgba(96,165,250,0.15);align-self:flex-end;}
.ai{text-align:left;color:#22c55e;background:rgba(34,197,94,0.15);align-self:flex-start;position:relative;}
.ai .dots{display:inline-block;margin-left:5px;}
.dot{height:6px;width:6px;background:white;border-radius:50%;display:inline-block;margin:0 2px;animation:blink 1s infinite;}
@keyframes blink{0%,80%,100%{opacity:0.2;}40%{opacity:1;}}

/* INPUT */
.input-area{display:flex;padding:15px;background:#111827;}
input{flex:1;padding:12px;border-radius:14px;border:none;outline:none;background:#1f2937;color:white;}
.send-btn{margin-left:10px;padding:10px 22px;background:#2563eb;border:none;color:white;border-radius:14px;cursor:pointer;transition:0.2s;font-weight:bold;}
.send-btn:hover{background:#1e40af;}

/* LOGIN SCREEN */
#loginScreen{position:absolute;inset:0;background:#0f172a;display:flex;justify-content:center;align-items:center;z-index:10;}
.login-box{background:#111827;padding:40px;border-radius:12px;width:320px;display:flex;flex-direction:column;align-items:center;}
.login-box input{width:100%;padding:10px;margin-bottom:10px;border:none;border-radius:12px;background:#1f2937;color:white;}
.login-box button{width:100%;padding:10px;border:none;border-radius:12px;background:#2563eb;color:white;cursor:pointer;margin-bottom:5px;font-weight:bold;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
    <div class="login-box">
        <h2>Nano AI Pro Login</h2>
        <input id="username" placeholder="Username">
        <input id="password" type="password" placeholder="Passwort">
        <button onclick="login()">Login</button>
        <button onclick="register()">Registrieren</button>
    </div>
</div>

<!-- SIDEBAR -->
<div class="sidebar">
    <div class="logo">
        <img src="NanoAI.png" alt="Nano AI Logo">
        <span>Nano AI</span>
    </div>
    <button class="new-chat" onclick="createChat()">+ Neuer Chat</button>
    <div class="chat-list" id="chatList"></div>
</div>

<!-- MAIN AREA -->
<div class="main">
    <div class="topbar">
        <div class="profile" onclick="toggleDropdown()" id="profileName">Profil</div>
        <div class="dropdown" id="dropdown">
            <button onclick="alert('Profilseite kommt bald')">Profil</button>
            <select id="languageSelect" onchange="changeLanguage()">
                <option value="de">Deutsch</option>
                <option value="en">English</option>
                <option value="fr">Fran√ßais</option>
                <option value="es">Espa√±ol</option>
                <option value="it">Italiano</option>
                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                <option value="tr">T√ºrk√ße</option>
                <option value="pl">Polski</option>
                <option value="nl">Nederlands</option>
                <option value="pt">Portugu√™s</option>
            </select>
            <button onclick="logout()">Logout</button>
        </div>
    </div>
    <div class="chat" id="chat"></div>
    <div class="input-area">
        <input type="text" id="prompt" placeholder="Nachricht schreiben..." onkeydown="if(event.key==='Enter') sendPrompt()">
        <button class="send-btn" onclick="sendPrompt()">Senden</button>
    </div>
</div>

<script>
const API_URL="https://unexempt-predenial-aryanna.ngrok-free.dev"; // AI Backend
const CHAT_API="/chats"; // placeholder f√ºr persistente Chat Speicherung

let users=JSON.parse(localStorage.getItem("nano_users"))||{};
let currentUser=localStorage.getItem("nano_currentUser");
let currentChat=null;
let currentLanguage=localStorage.getItem("nano_language")||"de";

// Language
function changeLanguage(){
    currentLanguage=document.getElementById("languageSelect").value;
    localStorage.setItem("nano_language",currentLanguage);
    // alert("Sprache ge√§ndert: "+currentLanguage);
}

// Dropdown
function toggleDropdown(){
    const d=document.getElementById("dropdown");
    d.style.display=d.style.display==="flex"?"none":"flex";
}

// LOGIN
function saveUsers(){localStorage.setItem("nano_users",JSON.stringify(users));}
function register(){const u=username.value.trim();const p=password.value.trim();if(!u||!p)return alert("Felder ausf√ºllen");if(users[u])return alert("User existiert");users[u]={password:p,chats:{}};saveUsers();alert("Registriert!");}
function login(){const u=username.value.trim();const p=password.value.trim();if(!users[u]||users[u].password!==p)return alert("Falsche Daten");currentUser=u;localStorage.setItem("nano_currentUser",u);startApp();}
function logout(){localStorage.removeItem("nano_currentUser");location.reload();}

// CHATS
function createChat(){
    const id=Date.now();
    users[currentUser].chats[id]={name:"Neuer Chat",messages:[]};
    currentChat=id;
    saveUsers();
    renderChats();
    renderMessages();
}

function renameChat(id){
    const name=prompt("Neuer Name:");
    if(name) users[currentUser].chats[id].name=name;
    saveUsers();
    renderChats();
}

function deleteChat(id){
    if(!confirm("Chat l√∂schen?")) return;
    delete users[currentUser].chats[id];
    currentChat=null;
    saveUsers();
    renderChats();
    document.getElementById("chat").innerHTML="";
}

function selectChat(id){
    currentChat=id;
    renderChats();
    renderMessages();
}

function renderChats(){
    const list=document.getElementById("chatList");
    list.innerHTML="";
    if(!currentUser) return;
    const chats=users[currentUser].chats;
    for(let id in chats){
        const div=document.createElement("div");
        div.className="chat-item";
        if(id===currentChat) div.classList.add("active");
        const title=document.createElement("span");
        title.innerText=chats[id].name;
        title.onclick=()=>selectChat(id);
        const actions=document.createElement("div");
        actions.className="chat-actions";
        const renameBtn=document.createElement("button");renameBtn.innerText="‚úè";renameBtn.onclick=(e)=>{e.stopPropagation();renameChat(id)};
        const deleteBtn=document.createElement("button");deleteBtn.innerText="üóë";deleteBtn.onclick=(e)=>{e.stopPropagation();deleteChat(id)};
        actions.append(renameBtn,deleteBtn);
        div.append(title,actions);
        list.appendChild(div);
    }
}

function renderMessages(){
    const chatDiv=document.getElementById("chat");
    chatDiv.innerHTML="";
    if(!currentChat) return;
    users[currentUser].chats[currentChat].messages.forEach(m=>{
        const div=document.createElement("div");
        div.className="message "+(m.role==="ai"?"ai":"user");
        div.innerText=m.text;
        chatDiv.appendChild(div);
    });
}

// AI Typing mit Punkten
function typeText(container,text){
    container.innerText="";
    let i=0;
    const interval=setInterval(()=>{
        container.innerText+=text.charAt(i);
        i++;
        if(i>=text.length) clearInterval(interval);
        container.scrollIntoView({behavior:"smooth"});
    },25);
}

function sendPrompt(){
    const input=document.getElementById("prompt");
    const text=input.value.trim();
    if(!text||!currentChat) return;

    // User Message
    users[currentUser].chats[currentChat].messages.push({role:"user",text});
    renderMessages();
    input.value="";

    // AI placeholder
    const chatDiv=document.getElementById("chat");
    const botDiv=document.createElement("div");
    botDiv.className="message ai";
    const dots=document.createElement("span");dots.className="dots";
    for(let d=0;d<3;d++){const dot=document.createElement("span");dot.className="dot";dots.appendChild(dot);}
    botDiv.appendChild(dots);
    chatDiv.appendChild(botDiv);
    chatDiv.scrollTop=chatDiv.scrollHeight;

    // Fetch AI
    fetch(API_URL,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({prompt:text,language:currentLanguage})
    })
    .then(res=>res.json())
    .then(data=>{
        botDiv.removeChild(dots);
        typeText(botDiv,data.text);
        users[currentUser].chats[currentChat].messages.push({role:"ai",text:data.text});
        saveUsers();
    })
    .catch(()=>{botDiv.innerText="Fehler beim Server";});
}

// Start App
function startApp(){
    loginScreen.style.display="none";
    profileName.innerText=currentUser;
    document.getElementById("languageSelect").value=currentLanguage;
    renderChats();
    renderMessages();
}

if(currentUser) startApp();
else loginScreen.style.display="flex";
</script>
</body>
</html>
