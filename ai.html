<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nano AI</title>

<style>
* { margin:0; padding:0; box-sizing:border-box; }

body {
    display:flex;
    height:100vh;
    font-family: system-ui, sans-serif;
    background:#0f172a;
    color:white;
}

/* SIDEBAR */
.sidebar {
    width:260px;
    background:#111827;
    display:flex;
    flex-direction:column;
    padding:20px;
}

.sidebar h1 {
    font-size:18px;
    margin-bottom:20px;
}

.new-chat {
    padding:10px;
    background:#2563eb;
    border:none;
    border-radius:8px;
    color:white;
    cursor:pointer;
    margin-bottom:20px;
}

.chat-list {
    flex:1;
    overflow-y:auto;
}

.chat-item {
    padding:10px;
    border-radius:6px;
    margin-bottom:8px;
    cursor:pointer;
    background:#1f2937;
}

.chat-item:hover {
    background:#374151;
}

/* CHAT AREA */
.chat-area {
    flex:1;
    display:flex;
    flex-direction:column;
}

.messages {
    flex:1;
    overflow-y:auto;
    padding:40px;
    display:flex;
    flex-direction:column;
}

.message {
    max-width:60%;
    padding:14px;
    margin-bottom:15px;
    border-radius:14px;
    line-height:1.4;
}

.user {
    align-self:flex-end;
    background:#2563eb;
}

.bot {
    align-self:flex-start;
    background:#1f2937;
}

/* INPUT */
.input-area {
    padding:20px;
    background:#111827;
    display:flex;
}

.input-area input {
    flex:1;
    padding:14px;
    border:none;
    border-radius:8px;
    outline:none;
}

.input-area button {
    margin-left:10px;
    padding:14px 20px;
    border:none;
    border-radius:8px;
    background:#2563eb;
    color:white;
    cursor:pointer;
}
</style>
</head>

<body>

<div class="sidebar">
    <h1>Nano AI</h1>
    <button class="new-chat" onclick="createChat()">+ Neuer Chat</button>
    <div class="chat-list" id="chatList"></div>
</div>

<div class="chat-area">
    <div class="messages" id="messages"></div>
    <div class="input-area">
        <input type="text" id="prompt" placeholder="Nachricht schreiben..." onkeydown="if(event.key==='Enter') sendPrompt()">
        <button onclick="sendPrompt()">Senden</button>
    </div>
</div>

<script>

const API_URL = "https://unexempt-predenial-aryanna.ngrok-free.dev"; // z.B. https://deinserver.com/generate

let chats = JSON.parse(localStorage.getItem("nano_chats")) || {};
let currentChat = null;

/* CHAT ERSTELLEN */
function createChat() {
    const id = Date.now();
    chats[id] = [];
    currentChat = id;
    saveChats();
    renderChats();
    loadChat(id);
}

/* CHATS SPEICHERN */
function saveChats() {
    localStorage.setItem("nano_chats", JSON.stringify(chats));
}

/* SIDEBAR RENDERN */
function renderChats() {
    const list = document.getElementById("chatList");
    list.innerHTML = "";
    Object.keys(chats).forEach(id => {
        const div = document.createElement("div");
        div.className = "chat-item";
        div.innerText = "Chat " + id;
        div.onclick = () => loadChat(id);
        list.appendChild(div);
    });
}

/* CHAT LADEN */
function loadChat(id) {
    currentChat = id;
    const messagesDiv = document.getElementById("messages");
    messagesDiv.innerHTML = "";
    chats[id].forEach(msg => {
        addMessage(msg.text, msg.role, false);
    });
}

/* MESSAGE HINZUFÃœGEN */
function addMessage(text, role, save=true) {
    const div = document.createElement("div");
    div.className = "message " + role;
    div.innerText = text;
    document.getElementById("messages").appendChild(div);
    div.scrollIntoView();

    if(save && currentChat) {
        chats[currentChat].push({text, role});
        saveChats();
    }
}

/* SENDEN */
async function sendPrompt() {
    const input = document.getElementById("prompt");
    const prompt = input.value.trim();
    if(!prompt || !currentChat) return;

    addMessage(prompt, "user");
    input.value = "";

    addMessage("...", "bot");

    try {
        const res = await fetch(API_URL, {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({prompt})
        });

        const data = await res.json();

        document.querySelector(".messages").lastChild.remove();
        addMessage(data.text, "bot");

    } catch(err) {
        document.querySelector(".messages").lastChild.remove();
        addMessage("Server nicht erreichbar", "bot");
    }
}

/* START */
renderChats();
createChat();

</script>

</body>
</html>
